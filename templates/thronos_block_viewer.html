
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Thronos Block Viewer</title>
  <style>
    body {
      background-color: #111;
      color: #0f0;
      font-family: monospace;
      padding: 20px;
    }
    pre {
      white-space: pre-wrap;
      word-wrap: break-word;
      background: #000;
      padding: 15px;
      border: 1px solid #0f0;
    }
    table {
      border-collapse: collapse;
      width: 100%;
      margin-top: 30px;
      background: #000;
      color: #0f0;
    }
    th, td {
      border: 1px solid #0f0;
      padding: 10px;
      text-align: left;
    }
    th {
      background-color: #222;
    }
    h1 {
      color: #0f0;
    }
    .section-title {
      margin-top: 40px;
      color: #0f0;
    }
  </style>
</head>
<body>

<div style="background:#000;padding:10px;border-bottom:1px solid #0f0;text-align:center;">
  <a href="/" style="color:#0f0;margin:10px;">🏠 Home</a>
  <a href="/pledge" style="color:#0f0;margin:10px;">🔥 Pledge</a>
  <a href="/viewer" style="color:#0f0;margin:10px;">📦 Viewer</a>
  <a href="/send" style="color:#0f0;margin:10px;">💸 Send</a>
  <a href="/wallet" style="color:#0f0;margin:10px;">👛 Wallet</a>
  <a href="/docs" style="color:#0f0;margin:10px;">📚 Docs</a>
</div>

<h1>🧱 Thronos Blockchain Viewer</h1>
<p>Reading from <code>phantom_tx_chain.json</code></p>

<h2 class="section-title">⏳ Next Halving Countdown</h2>
<div id="halvingCountdown" style="font-weight:bold; margin-bottom:20px;">Calculating...</div>

<h2 class="section-title">📝 Raw JSON Output</h2>
<pre id="output">Loading...</pre>

<h2 class="section-title">📦 Block Explorer Table</h2>
<table id="block-table">
  <thead>
    <tr>
      <th>Block Hash</th>
      <th>Miner BTC Address</th>
      <th>THR Address</th>
      <th>Reward</th>
      <th>Reward to Miner</th>
      <th>Fee</th>
      <th>Timestamp (UTC)</th>
    </tr>
  </thead>
  <tbody id="block-rows"></tbody>
</table>

<script>
function formatTimeLeft(seconds) {
  const days = Math.floor(seconds / 86400);
  const hours = Math.floor((seconds % 86400) / 3600);
  const minutes = Math.floor((seconds % 3600) / 60);
  return `${days} days, ${hours} hours, ${minutes} minutes`;
}

fetch("/chain")
  .then(response => response.json())
  .then(data => {
    document.getElementById("output").innerText = JSON.stringify(data, null, 2);
    const tableBody = document.getElementById("block-rows");

    const epochSize = 210001;
    const currentHeight = data.length;
    const nextHalving = epochSize * Math.ceil(currentHeight / epochSize);
    const remainingBlocks = nextHalving - currentHeight;
    const estimatedSeconds = remainingBlocks * 60;
    document.getElementById("halvingCountdown").textContent = formatTimeLeft(estimatedSeconds);

    data.forEach(block => {
      const row = document.createElement("tr");
      const utcTime = new Date(block.timestamp).toISOString().replace("T", " ").replace("Z", " UTC");
      row.innerHTML = `
        <td>${block.block_hash}</td>
        <td>${block.miner_btc_address}</td>
        <td>${block.thr_address||''}</td>
        <td>${block.reward}</td>
        <td>${block.reward_to_miner}</td>
        <td>${block.pool_fee}</td>
        <td>${utcTime}</td>
      `;
      tableBody.appendChild(row);
    });
  })
  .catch(err => {
    document.getElementById("output").innerText = "Error loading chain: " + err.message;
    console.error("Error loading chain:", err);
  });
</script>
</body>
</html>
