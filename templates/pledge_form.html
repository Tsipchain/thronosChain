<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>🔥 Thronos Pledge System</title>
  <style>
    body {
      background-color: #000;
      color: #0f0;
      font-family: monospace;
      text-align: center;
      margin: 0;
      padding: 0;
    }
    nav {
      background: #111;
      padding: 10px;
    }
    nav a {
      color: #0f0;
      margin: 0 10px;
      text-decoration: none;
    }
    h1 {
      margin-top: 20px;
    }
    form {
      margin: 20px auto;
      width: 80%;
      max-width: 600px;
      text-align: left;
    }
    label {
      display: block;
      margin-top: 15px;
      font-weight: bold;
    }
    input, textarea {
      width: 100%;
      padding: 8px;
      margin-top: 5px;
      background-color: #111;
      color: #0f0;
      border: 1px solid #0f0;
      box-sizing: border-box;
      font-family: monospace;
    }
    textarea { resize: vertical; }
    #btc-instructions {
      margin: 20px auto;
      padding: 15px;
      border: 1px dashed #0f0;
      text-align: center;
    }
    #btc-instructions img {
      cursor: pointer;
      margin-top: 10px;
    }
    button {
      display: block;
      margin: 20px auto;
      padding: 10px 20px;
      background-color: #0f0;
      color: #000;
      border: none;
      font-weight: bold;
      cursor: pointer;
    }
    #result {
      width: 80%;
      max-width: 600px;
      margin: 20px auto;
      padding: 15px;
      background: #111;
      border: 1px solid #0f0;
      text-align: left;
      white-space: pre-wrap;
    }
    #result.error { border-color: #f00; color: #f00; }
    #result.success { border-color: #0f0; }
    a.pdf-link {
      color: #0f0;
      text-decoration: underline;
    }
  </style>
</head>
<body>

  <nav>
    <a href="/">🏠 Home</a>
    <a href="/pledge">🔥 Pledge</a>
    <a href="/viewer">📦 Viewer</a>
    <a href="/send">💸 Send</a>
    <a href="/docs">📚 Docs</a>
  </nav>

  <h1>🔥 Pledge to the Flame</h1>

  <form id="pledgeForm">
    <label for="btc_address">BTC Address (KYC):</label>
    <input type="text" id="btc_address" placeholder="e.g. 1FQov4P8yz..." required>

    <label for="pledge_text">Your Pledge:</label>
    <textarea id="pledge_text" rows="4">I hereby pledge allegiance to the Thronos Chain.</textarea>

    <div id="btc-instructions">
      <p>Send a minimum BTC fee to:</p>
      <p><strong>1FQov4P8yzUU1Af4C5QNyAfQauc4maytKo</strong></p>
      <img
        src="https://api.qrserver.com/v1/create-qr-code/?size=150x150&data=bitcoin:1FQov4P8yzUU1Af4C5QNyAfQauc4maytKo"
        alt="QR Code" title="Click to copy address">
      <p style="font-size:12px;">(Click QR to copy address)</p>
    </div>

    <button type="submit">Submit Pledge</button>
  </form>

  <div id="result"></div>

 <script>
  // copy-on-click for QR
  document.querySelector("#btc-instructions img")
    .addEventListener("click", () => {
      navigator.clipboard.writeText("1FQov4P8yzUU1Af4C5QNyAfQauc4maytKo");
      alert("📋 BTC address copied to clipboard");
    });

  // handle form submit
  document.getElementById("pledgeForm").addEventListener("submit", async e => {
    e.preventDefault();
    const resultDiv = document.getElementById("result");
    resultDiv.className = "";
    resultDiv.textContent = "⏳ Processing...";

    const payload = {
      btc_address: document.getElementById("btc_address").value.trim(),
      pledge_text: document.getElementById("pledge_text").value.trim()
    };

    try {
      const res = await fetch("/pledge_submit", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(payload)
      });
      const data = await res.json();

      if (!res.ok) throw new Error(data.message || data.error || res.statusText);

      // επιτυχείς καταστάσεις: "verified" ή "already_verified"
      resultDiv.classList.add("success");
      resultDiv.innerHTML = `
        <strong>✅ ${ data.status === "already_verified" ? "Already Verified" : "Pledge Accepted!" }</strong><br><br>
        THR Address: <code>${data.thr_address}</code><br>
        Pledge Hash: <code>${data.pledge_hash}</code><br><br>
        📄 <a class="pdf-link" href="/contracts/${data.pdf_filename}" target="_blank">
          Download Contract PDF
        </a><br><br>
        🚀 <a href="/wallet_data/${data.thr_address}">Go to Wallet…</a>
          Go to Wallet & Download CGMiner Kit
        </a>
      `;
    } catch (err) {
      resultDiv.classList.add("error");
      resultDiv.innerHTML = `<strong>❌ Error:</strong> ${err.message}`;
    }
  });
</script>


</body>
</html>
